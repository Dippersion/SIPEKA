<!DOCTYPE html>
<html>
<head>
    <title>Chat Realtime</title>
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <style>
        body { font-family: Arial; margin: 20px; }
        #chat-box { border:1px solid #ccc; padding:10px; height:400px; overflow-y:auto; }
        #msg { width:80%; padding:8px; }
        button { padding:8px 12px; }
        .me { color: green; }
        .other { color: blue; }
    </style>
</head>
<body>
<h2>ðŸ’¬ Chat Realtime</h2>

<select id="receiver">
    {% for u in users %}
        <option value="{{u['id']}}">{{u['username']}} ({{u['role']}})</option>
    {% endfor %}
</select>

<div id="chat-box">
    {% for m in messages %}
        <div><b>{{m['sender_name']}}</b>: {{m['message']}}</div>
    {% endfor %}
</div>

<input type="text" id="msg" placeholder="Ketik pesan...">
<button id="send">Kirim</button>

<script>
    const socket = io();
    const username = "{{user['username']}}";
    const userId = {{user['id']}};

    document.getElementById("send").onclick = () => {
        const message = document.getElementById("msg").value;
        const receiverId = document.getElementById("receiver").value;
        if (!message.trim()) return;
        socket.emit("send_message", { receiver_id: receiverId, message });
        document.getElementById("msg").value = "";
    };

    socket.on("receive_message", (data) => {
        const chatBox = document.getElementById("chat-box");
        const div = document.createElement("div");
        div.className = (data.sender_id === userId) ? "me" : "other";
        div.innerHTML = `<b>${data.sender}</b>: ${data.message}`;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    });
</script>
</body>
</html>
