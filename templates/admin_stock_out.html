{% extends "base.html" %}
{% block content %}
<h3>Barang Keluar</h3>

<!-- Form Tambah Barang Keluar -->
<form method="post" action="{{ url_for('admin_stock_out_add') }}" enctype="multipart/form-data"
      class="row gx-2 gy-2 align-items-center mb-3">
  <div class="col-md-3 col-sm-6">
    <input name="nama_barang" class="form-control form-control-sm" placeholder="Nama Barang" required>
  </div>
  <div class="col-md-1 col-sm-3">
    <input name="qty" type="number" class="form-control form-control-sm" placeholder="Qty" required>
  </div>
  <div class="col-md-2 col-sm-4">
    <input name="ruangan" class="form-control form-control-sm" placeholder="Ruangan" required>
  </div>
  <div class="col-md-2 col-sm-4">
    <input name="penanggung_jawab" class="form-control form-control-sm" placeholder="Penanggung Jawab" required>
  </div>
  <div class="col-md-3 col-sm-6">
    <input type="file" name="bukti_file" accept=".jpg,.jpeg,.png,.pdf" class="form-control form-control-sm">
  </div>
  <div class="col-md-1 col-sm-12 d-grid">
    <button type="submit" class="btn btn-warning w-100">Tambah</button>
  </div>
</form>

<!-- Tabel Data Barang Keluar -->
<table class="table table-bordered table-hover align-middle">
  <thead class="table-warning text-center">
    <tr>
      <th>No</th>
      <th>Barang</th>
      <th>Qty</th>
      <th>Ruangan</th>
      <th>Penanggung Jawab</th>
      <th>Tanggal Keluar</th>
      <th>Aksi</th>
    </tr>
  </thead>
  <tbody>
    {% for i in items %}
    <tr>
      <td class="text-center">{{ loop.index + ((page - 1) * per_page) }}</td>
      <td>{{ i['nama_barang'] }}</td>
      <td>{{ i['qty'] }}</td>
      <td>{{ i['ruangan'] }}</td>
      <td>{{ i['penanggung_jawab'] }}</td>
      <td>{{ i['tgl_keluar'] }}</td>

      <td class="text-center">
        {% if i['bukti_path'] %}
          <!-- Tombol aksi sejajar dengan jarak -->
          <div class="d-flex justify-content-center gap-2 flex-wrap">
            <a href="{{ url_for('static', filename=i['bukti_path']) }}" target="_blank"
               class="btn btn-success btn-sm shadow-sm">Lihat Bukti</a>

            <button type="button" class="btn btn-secondary btn-sm shadow-sm"
                    data-bs-toggle="modal" data-bs-target="#editModal{{ i['id'] }}">
              Edit Bukti
            </button>

            <form action="{{ url_for('admin_stock_out_delete', item_id=i['id']) }}" method="post" class="d-inline">
              <button type="submit" class="btn btn-danger btn-sm shadow-sm"
                      onclick="return confirm('Yakin ingin menghapus data ini?')">Hapus</button>
            </form>
          </div>

          <!-- Modal Edit Bukti -->
          <div class="modal fade" id="editModal{{ i['id'] }}" tabindex="-1"
               aria-labelledby="editModalLabel{{ i['id'] }}" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content border-0 shadow">
                <div class="modal-header bg-secondary text-white">
                  <h5 class="modal-title" id="editModalLabel{{ i['id'] }}">Edit Bukti Barang Keluar</h5>
                  <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form action="{{ url_for('admin_stock_out_edit_file', item_id=i['id']) }}"
                      method="post" enctype="multipart/form-data">
                  <div class="modal-body">
                    <input type="file" name="bukti_file" accept=".jpg,.jpeg,.png,.pdf"
                           class="form-control" required>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Batal</button>
                    <button type="submit" class="btn btn-secondary">Simpan Perubahan</button>
                  </div>
                </form>
              </div>
            </div>
          </div>

        {% else %}
          <span class="text-muted fst-italic">Belum ada bukti</span>
          <form action="{{ url_for('admin_stock_out_delete', item_id=i['id']) }}" method="post" class="d-inline">
            <button type="submit" class="btn btn-danger btn-sm mt-1"
                    onclick="return confirm('Yakin ingin menghapus data ini?')">Hapus</button>
          </form>
        {% endif %}
      </td>
    </tr>
    {% else %}
    <tr>
      <td colspan="7" class="text-center text-muted">Belum ada data.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Pagination -->
<nav aria-label="Page navigation" class="mt-3">
  <ul class="pagination justify-content-center">
    {% if page > 1 %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page - 1 }}">« Prev</a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">« Prev</span></li>
    {% endif %}

    {% for p in range(1, total_pages + 1) %}
      <li class="page-item {% if p == page %}active{% endif %}">
        <a class="page-link" href="?page={{ p }}">{{ p }}</a>
      </li>
    {% endfor %}

    {% if page < total_pages %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page + 1 }}">Next »</a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Next »</span></li>
    {% endif %}
  </ul>
</nav>

{% endblock %}
