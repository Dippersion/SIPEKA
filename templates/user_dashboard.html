{% extends "base.html" %}
{% block content %}

<main class="card shadow-sm p-4">
  <h3 class="mb-4">Daftar Laporan Saya</h3>

  <div class="mb-3">
    <a href="{{ url_for('user_report_new') }}" class="btn btn-success">+ Buat Laporan</a>
  </div>

  <div class="table-responsive">
    <table class="table table-bordered table-hover align-middle">
      <thead class="table-light">
  <tr>
    <th>No</th> <!-- ✅ kolom nomor baru -->
    <th>Tanggal</th>
    <th>Tanggal Update</th>   <!-- ✅ kolom baru -->
    <th>Judul</th>
    <th>Unit/Ruangan</th>
    <th>Deskripsi</th>
    <th>Foto</th>
    <th>Komentar</th>
    <th>Status</th>
  </tr>
</thead>
<tbody>
  {% for r in reports %}
  <tr>
    <td class="text-center">{{ loop.index + ((page - 1) * per_page) }}</td>  <!-- ✅ nomor otomatis per halaman -->
    <td>{{ r['created_at'] }}</td>
    <td>{{ r['updated_at'] or '-' }}</td>   <!-- ✅ data baru -->
    <td>{{ r['title'] }}</td>
    <td>{{ r['unit'] }}</td>
    <td>{{ r['description'] }}</td>
    <td>
      {% if r['image_path'] %}
        <a href="{{ url_for('static', filename=r['image_path']) }}" target="_blank">
          <img src="{{ url_for('static', filename=r['image_path']) }}"
               alt="foto" class="img-thumbnail" style="max-height:80px;">
        </a>
      {% else %}
        -
      {% endif %}
    </td>
    <td>{{ r['comment'] or '-' }}</td>
    <td>
      <span class="badge 
		{% if r['status']=='Selesai' %}bg-success text-white
		{% elif r['status']=='Proses' %}bg-warning text-dark
		{% else %}bg-secondary text-white{% endif %}">
		{{ r['status'] }}
	  </span>

    </td>
  </tr>
  {% else %}
  <td colspan="9" class="text-center text-muted">Belum ada laporan.</td> <!-- ✅ 9 kolom total -->
  {% endfor %}
</tbody>

    </table>
  </div>
      </table>
  </div>

   <!-- ✅ Pagination -->
  {% if total_pages > 1 %}
  <nav aria-label="Page navigation" class="mt-3">
    <ul class="pagination justify-content-center">
      <li class="page-item {% if page <= 1 %}disabled{% endif %}">
        <a class="page-link" href="?page={{ page-1 }}">« Prev</a>
      </li>

      {% for p in range(1, total_pages + 1) %}
        <li class="page-item {% if p == page %}active{% endif %}">
          <a class="page-link" href="?page={{ p }}">{{ p }}</a>
        </li>
      {% endfor %}

      <li class="page-item {% if page >= total_pages %}disabled{% endif %}">
        <a class="page-link" href="?page={{ page+1 }}">Next »</a>
      </li>
    </ul>
  </nav>
  {% endif %}
</main>
{% endblock %}
